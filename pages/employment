<style>
     @media (max-width: 767px) {
         #promo_header{
             width:95%;
             margin-left:auto;
             margin-right:auto;
         }
     }
</style>



<h1 id="promo_header">Promotions</h1>
<div id='promo_container'>
    <script id="promo_template" type="x-tmpl-mustache/text">
        <div class='promo_div'>
            <div class='promo_left_block'>
                <a href="{{promo_img}}" target="_blank" rel="lightbox">
                    <img alt="photo_{{name}}" src="{{promo_img}}"/>
                </a>
                
            </div>
            <div class="promo_right_block">
                <a class='promo_name' href='/promotions/{{slug}}'>{{name}}</a>
                <p class='promotionable_name'><a href='/{{store_slug}}'>{{store_name}}</a></p>
                <p class='promo_date_string'>{{date_string}}</p>
                <p class='promo_desc_short'>{{description}}</p>
            </div>
        </div>
    </script>
</div>


<div class="no_promos">
    There are currently no promotions. Please check back at a later date!
</div>

<script>
    $(document).ready(function() {
        function renderAll(){
            all_promos = getJobsList();
            all_promos = all_promos.reverse();
            promo_array = []
             $.each( all_promos , function( key, val ){
                if (val.description.length > 110) {
                   val.description =  val.description.substring(0,100)+'...';
                } 
                 today = new Date();
                 webDate = new Date(val.show_on_web_date);
                 if (today >= webDate) {
                    
                    val.date_string = get_date_string(val.start_date, val.end_date)
                    if (val.jobable_type == 'Store'){
                        var store_details = getStoreDetailsByID(val.promotionable_id)
                        val.store_slug = 'directory/'+store_details.slug
                        val.store_name = store_details.name
                        
                    } else {
                        val.store_name = "Heartland Town Centre"
                        val.store_slug = 'home'
                    }
                    if (!val.promo_image_url_abs ||  val.promo_image_url_abs.indexOf('missing.png') > -1 || val.promo_image_url_abs.length === 0){
                        if (val.promotionable_type == 'Store'){
                           if(!store_details.store_front_url ||  store_details.store_front_url.indexOf('missing.png') > -1 || store_details.store_front_url.length === 0){
                            val.promo_img = 'http://assets.kodekloud.io/sites/55ddf3f86e6f640775000000/307bb19a2f979883e5614374003bfeb9/default.png'
                            } else {
                                val.promo_img = store_details.store_front_url
                            }   
                        } else {
                            
                            val.promo_img = 'http://assets.kodekloud.io/sites/55ddf3f86e6f640775000000/307bb19a2f979883e5614374003bfeb9/default.png'
                        }
                           
                    } else {
                        val.promo_img = val.promo_image_url_abs
                    }
                    
                     promo_array.push(val)
                 } 
             });
            
            
            
            if (promo_array.length > 0){
                renderPageData("#promo_container", "#promo_template", promo_array, "all_promos")
            } else {
                $(".no_promos").show();
            }
            
            $.getScript("http://cdn.jsdelivr.net/slimbox/2.0.5/js/slimbox2.js");
            $('head').append('<link rel="stylesheet" href="http://cdn.jsdelivr.net/slimbox/2.0.5/css/slimbox2.css" type="text/css" media="screen" />');
            $(".loading_overlay").hide();    
        }
        
        
        loadMallDataCached(renderAll); 
        // loadMallData(renderAll); 
        
    })
</script>